# ADR-008: Núcleo ANIMA Se Comporta como um Kernel Cognitivo com Multitarefa e Execução Interrompível

**Status:** Aceito
**Data:** 2026-01-05
**Decisores:** @RichardRosenblat
**Contexto:** Comportamento de longa duração, concorrência, interrupções, clareza arquitetural

---

## Contexto

A ANIMA não é um chatbot de requisição–resposta.
É um sistema cognitivo de longa duração e com estado que deve:

* Executar múltiplos comportamentos concorrentemente
* Manter consciência através do tempo
* Reagir a eventos externos enquanto tarefas estão em progresso
* Interromper, pausar, cancelar ou substituir ações em andamento com segurança
* Permanecer observável, auditável e explicável

Designs iniciais que tratavam o Núcleo como um "loop principal" ou script de orquestração provaram ser insuficientes:

* Execução bloqueante previne responsividade
* Comportamento assíncrono implícito esconde transições de estado
* Cancelamento via terminação forçada de tarefa arrisca corrupção
* Lógica de interrupção ad-hoc torna-se não testável e insegura

Para suportar **interação compatível com humanos**, a ANIMA deve raciocinar e agir mais como um sistema operacional do que como um script.

---

## Decisão

O Núcleo ANIMA é formalmente definido como um **Kernel Cognitivo**.

O Núcleo DEVE:

* Gerenciar tarefas concorrentes de longa duração
* Tratar ações como unidades de execução supervisionadas
* Suportar interrupção e cancelamento cooperativos
* Nunca bloquear na execução de tarefas
* Centralizar agendamento, supervisão e transições de estado

Tarefas não são chamadas de função.
Elas são **processos gerenciados** sob supervisão do kernel.

---

## Definição

### Responsabilidades do Kernel Cognitivo

O Núcleo ANIMA, atuando como kernel, é responsável por:

* Gerenciamento de ciclo de vida de tarefas (spawn, run, pause, cancel, complete)
* Roteamento e arbitragem de interrupções
* Despacho e priorização de eventos
* Controle de execução consciente de capacidades
* Agendamento consciente de recursos
* Observabilidade e registro de auditoria
* Interação segura entre cognição, linguagem e incorporação

O Núcleo não "faz trabalho" diretamente.
Ele **supervisiona trabalho**.

---

### Tarefas como Unidades de Execução Gerenciadas

Uma tarefa na ANIMA é uma execução de um plano que contém múltiplos objetos de intenção de ação e contingências.

Tarefas são:
* Explicitamente criadas
* Identificáveis
* Observáveis
* Interrompíveis
* Cooperativas em sua execução

Tarefas DEVEM:

* Expor estado de ciclo de vida
* Verificar periodicamente sinais de controle
* Terminar de forma limpa quando interrompidas
* Nunca assumir execução ininterrupta

Isso espelha semântica de processo de sistema operacional, não chamadas assíncronas tradicionais.

---

### Modelo de Interrupção Cooperativa

A ANIMA adota **interrupção cooperativa**, não terminação forçada.

O Kernel PODE:

* Sinalizar pausa
* Sinalizar cancelamento
* Sinalizar mudança de prioridade

Tarefas DEVEM decidir:

* Quando é seguro pausar
* Como limpar recursos
* Como terminar graciosamente

Isso garante:

* Segurança de recursos
* Comportamento previsível
* Transições de estado explicáveis

---

### Kernel vs Espaço de Usuário

O Núcleo aplica uma separação estrita:

* **Espaço do kernel**

  * Agendamento de tarefas
  * Mediação de acesso à memória
  * Aplicação de capacidades
  * Invocação de modelo de IA
  * Roteamento de interrupções

* **Espaço do usuário (Módulos / Tarefas)**

  * Lógica específica do domínio
  * IO e efeitos colaterais (via capacidades)
  * Execução cooperativa de tarefas

Módulos NÃO DEVEM:

* Gerenciar concorrência independentemente
* Interromper outras tarefas diretamente
* Acessar internos do kernel
* Ignorar supervisão

---

## Modelo de Multitarefa

O Kernel DEVE suportar execução concorrente de:

* Planejamento cognitivo
* Processamento de linguagem natural
* Tarefas de escuta / sensoriamento
* Tarefas de fala / incorporação
* Monitoramento ou comportamentos em segundo plano

Multitarefa é **de primeira classe**, não incidental.

O Kernel permanece responsivo mesmo enquanto tarefas estão em execução.

---

## Semântica de Interrupção

Interrupções são:

* Explícitas
* Orientadas por intenção
* Observáveis
* Reversíveis quando possível

Exemplos:

* Usuário fala enquanto ANIMA está falando
* Tarefa de maior prioridade substitui uma de menor prioridade
* Capacidade é revogada em meio à execução
* Evento ambiental invalida um plano

Interrupções são roteadas através do Kernel, nunca diretamente entre tarefas.

---

## Restrições e Invariantes

As seguintes restrições são invariantes arquiteturais:

* O Núcleo NUNCA DEVE bloquear na execução de tarefas
* Todo comportamento de longa duração DEVE ser baseado em tarefas
* Todas as interrupções DEVEM passar pelo Kernel
* Tarefas DEVEM ser interrompíveis por design
* Transições de estado DEVEM ser observáveis e registradas
* Nenhum módulo pode controlar unilateralmente o fluxo de execução

Essas restrições garantem segurança, previsibilidade e depurabilidade.

---

## Consequências

### Positivas

* Permite interação natural, semelhante à humana
* Suporta responsividade em tempo real
* Torna interrupção segura e explicável
* Permite composição de comportamento complexo
* Simplifica raciocínio sobre estado do sistema
* Alinha cognição, linguagem e incorporação sob um supervisor

---

### Tradeoffs

* Aumenta complexidade arquitetural
* Requer design disciplinado de tarefas
* Requer modelagem explícita de ciclo de vida
* Torna "hacks rápidos" impossíveis por design

Esses tradeoffs são intencionais e necessários para os objetivos da ANIMA.

---

## Justificativa

A interação humana é orientada por interrupções, concorrente e contextual.

Um sistema que não pode pausar, reconsiderar ou repriorizar **não pode se comportar inteligentemente em ambientes reais**.

Ao adotar um modelo de kernel:

* A ANIMA ganha consciência temporal
* Comportamento torna-se componível
* Segurança torna-se aplicável
* Inteligência torna-se sustentável ao longo do tempo

---

## Trabalho Futuro

* Formalizar políticas de prioridade e agendamento de tarefas
* Definir heurísticas de preempção de tarefas
* Implementar contabilidade de recursos no nível do kernel
* Criar ferramentas para introspecção e replay de tarefas
* Documentar melhores práticas para design cooperativo de tarefas

---

### Declaração Final

> **A ANIMA não executa instruções.
> Ela supervisiona comportamento.**

Essa é a propriedade definidora do seu Núcleo.
