# ADR-011: Arquitetura de Entrada Baseada em Eventos com Eventos de Linguagem Natural, Sistema e Semânticos

**Status:** Aceito  
**Data:** 2026-01-07  
**Decisores:** @RichardRosenblat  
**Contexto:** Modularidade, Observabilidade, Interrupções, PLN Opcional

---

## Contexto

Acoplar diretamente o Núcleo a entradas brutas (áudio, texto, sensores) causa acoplamento rígido, lógica de PLN duplicada e comportamento implícito inseguro. Para preservar modularidade, segurança e rastreabilidade, o Núcleo deve consumir apenas eventos estruturados via um contrato unificado.

---

## Decisão

O Núcleo ANIMA consome apenas eventos de entrada estruturados, nunca sinais brutos.

Todas as entradas—humanas, de sistema ou ambientais—DEVEM ser transformadas em eventos por módulos (via seu Adaptador) antes de alcançar o Núcleo.

Tipos de evento são canônicos e com namespace:
- input.nl — linguagem natural (pré-semântica)
- input.system — fatos não-linguísticos, mecânicos/do sistema
- input.semantic — significado assertado pós-interpretação

---

## Envelope de Evento

Todos os eventos de entrada DEVEM usar o envelope de evento:
- payload DEVE ser estruturado e determinístico
- incluir execution_id, trace_id, span_id, thread_id, timestamp
- quaisquer metadados adicionais por ADR-004

---

## Categorias de Eventos Canônicos

### 1) Linguagem Natural (input_nl; Pré-Semântico)
Representa conteúdo linguístico bruto após captura/transcrição, sem interpretação.

Características:
- sem intenção
- sem suposições
- baixa confiança
- provenance="observed"

Exemplo:
```json
{
  "execution_id": "exec-123",
  "trace_id": "trace-aaa",
  "span_id": "span-001",
  "parent_span_id": null,
  "thread_id": "input-mic-1",
  "timestamp": "2026-01-07T12:34:56Z",
  "source": "module:microphone",
  "type": "input.nl",
  "payload": {
    "text": "send this file to discord",
    "language": "en-US",
    "confidence": 0.93,
    "provenance": "observed"
  }
}
```

---

### 2) Sistema / Mecânico (input.system; Não-Linguagem-Natural)
Representa fatos observáveis ou mudanças de estado, não linguagem.

Características:
- fatos determinísticos
- alta confiança
- nenhuma interpretação linguística necessária

Exemplo:
```json
{
  "execution_id": "exec-123",
  "trace_id": "trace-bbb",
  "span_id": "span-010",
  "parent_span_id": null,
  "thread_id": "input-vscode",
  "timestamp": "2026-01-07T12:35:10Z",
  "source": "module:vscode",
  "type": "input.system",
  "payload": {
    "action": "file_opened",
    "path": "/project/main.py"
  }
}
```

---

### 3) Semântico (input.semantic; Pós-Interpretação)
Representa significado assertado extraído por uma camada de PLN de um módulo capaz de PLN ou o Arcuate opcional.

Características:
- intenção explícita + confiança + proveniência
- Núcleo raciocina diretamente sobre estes
- ignora processamento linguístico adicional

Exemplo:
```json
{
  "execution_id": "exec-123",
  "trace_id": "trace-ccc",
  "span_id": "span-020",
  "parent_span_id": null,
  "thread_id": "nlp-arcuate",
  "timestamp": "2026-01-07T12:35:20Z",
  "source": "adapter:arcuate",
  "type": "input.semantic",
  "payload": {
    "intent": "send_message",
    "target": "discord",
    "content_ref": "file://active",
    "confidence": 0.88,
    "provenance": "arcuate"
  }
}
```

---

## Papel do Arcuate (ADR-009)

- O Arcuate do núcleo é um tradutor (PLN), não um controlador
- Responsabilidades:
  - consumir eventos input.nl
  - produzir eventos input.semantic
- Restrições:
  - opcional e intercambiável
  - NÃO DEVE acessar memória do Núcleo diretamente
  - NÃO DEVE realizar planejamento
  - payloads semânticos DEVEM incluir confiança e proveniência

Módulos podem produzir input.semantic diretamente se incorporarem PLN; o Núcleo permanece agnóstico à origem do significado.

---

## Responsabilidades do Núcleo

O Núcleo DEVE:
- ingerir eventos via uma fila de eventos unificada
- raciocinar apenas sobre eventos, não sinais brutos
- tratar input.semantic como significado assertado sujeito a políticas de segurança
- usar eventos para conduzir planejamento, criação de tarefas, interrupção e aplicação de política

---

## Interrupções como Eventos (ADR-005)

Interrupções entram como eventos de entrada:

```json
{
  "type": "input.semantic",
  "payload": {
    "intent": "interrupt",
    "target": "speech_output",
    "urgency": "high",
    "confidence": 0.95,
    "provenance": "arcuate|module"
  }
}
```

Isso permite classificação consistente (override/cancel/queue/clarification/emergency), aplicação de política e rastreabilidade.

---

## Observabilidade & Rastreabilidade (ADR-004)

Todos os eventos:
- carregam IDs de execução e correlação
- são registrados como registros estruturados em linhas do tempo particionadas por execução
- suportam reprodutibilidade, auditabilidade e visibilidade concorrente

---

## Consequências

### Positivas
- Forte desacoplamento entre Núcleo e módulos
- Fronteiras de confiança claras
- Tratamento natural de interrupções
- Comportamento mais seguro e auditável
- Prontidão para clustering/distribuição futuro

### Tradeoffs
- Requer schemas de evento disciplinados
- Precisa de ferramentas de visualização
- Módulos devem aderir a contratos de evento

---

## ADRs Relacionados

- ADR-003 — Protocolo Núcleo ↔ Módulo, leases
- ADR-004 — Modelo de observabilidade
- ADR-005 — Modelo de interrupção
- ADR-007 — Regras de infraestrutura & adaptador
- ADR-009 — Arcuate Opcional (PLN)
- ADR-010 — Divisão Adaptador–Atuador

---

## Declaração Final

ANIMA é um motor de raciocínio de eventos.  
Significado entra no Núcleo já moldado como eventos de entrada.  
Adaptadores padronizam, o kernel supervisiona e o Núcleo raciocina.
