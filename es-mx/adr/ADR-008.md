# ADR-008: El Núcleo ANIMA Se Comporta como un Kernel Cognitivo con Multitarea y Ejecución Interrumpible

**Estado:** Aceptado
**Fecha:** 2026-01-05
**Decisores:** @RichardRosenblat
**Contexto:** Comportamiento de larga duración, concurrencia, interrupciones, claridad arquitectónica

---

## Contexto

ANIMA no es un chatbot de solicitud–respuesta.
Es un sistema cognitivo de larga duración y con estado que debe:

* Ejecutar múltiples comportamientos concurrentemente
* Mantener conciencia a través del tiempo
* Reaccionar a eventos externos mientras las tareas están en progreso
* Interrumpir, pausar, cancelar o reemplazar acciones en curso de manera segura
* Permanecer observable, auditable y explicable

Los diseños iniciales que trataban el Núcleo como un "bucle principal" o script de orquestación resultaron insuficientes:

* La ejecución bloqueante previene la capacidad de respuesta
* El comportamiento asíncrono implícito oculta transiciones de estado
* La cancelación vía terminación forzada de tareas arriesga corrupción
* La lógica de interrupción ad-hoc se vuelve no probable e insegura

Para soportar **interacción compatible con humanos**, ANIMA debe razonar y actuar más como un sistema operativo que como un script.

---

## Decisión

El Núcleo ANIMA se define formalmente como un **Kernel Cognitivo**.

El Núcleo DEBE:

* Gestionar tareas concurrentes de larga duración
* Tratar acciones como unidades de ejecución supervisadas
* Soportar interrupción y cancelación cooperativas
* Nunca bloquear en la ejecución de tareas
* Centralizar programación, supervisión y transiciones de estado

Las tareas no son llamadas de función.
Son **procesos gestionados** bajo supervisión del kernel.

---

## Definición

### Responsabilidades del Kernel Cognitivo

El Núcleo ANIMA, actuando como kernel, es responsable de:

* Gestión de ciclo de vida de tareas (spawn, run, pause, cancel, complete)
* Enrutamiento y arbitraje de interrupciones
* Despacho y priorización de eventos
* Control de ejecución consciente de capacidades
* Programación consciente de recursos
* Observabilidad y registro de auditoría
* Interacción segura entre cognición, lenguaje e incorporación

El Núcleo no "hace trabajo" directamente.
**Supervisa trabajo**.

---

### Tareas como Unidades de Ejecución Gestionadas

Una tarea en ANIMA es una ejecución de un plan que contiene múltiples objetos de intención de acción y contingencias.

Las tareas son:
* Explícitamente creadas
* Identificables
* Observables
* Interrumpibles
* Cooperativas en su ejecución

Las tareas DEBEN:

* Exponer estado de ciclo de vida
* Verificar periódicamente señales de control
* Terminar limpiamente cuando se interrumpen
* Nunca asumir ejecución ininterrumpida

Esto refleja la semántica de proceso de sistema operativo, no llamadas asíncronas tradicionales.

---

### Modelo de Interrupción Cooperativa

ANIMA adopta **interrupción cooperativa**, no terminación forzada.

El Kernel PUEDE:

* Señalar pausa
* Señalar cancelación
* Señalar cambio de prioridad

Las tareas DEBEN decidir:

* Cuándo es seguro pausar
* Cómo limpiar recursos
* Cómo terminar graciosamente

Esto garantiza:

* Seguridad de recursos
* Comportamiento predecible
* Transiciones de estado explicables

---

### Kernel vs Espacio de Usuario

El Núcleo aplica una separación estricta:

* **Espacio del kernel**

  * Programación de tareas
  * Mediación de acceso a memoria
  * Aplicación de capacidades
  * Invocación de modelo de IA
  * Enrutamiento de interrupciones

* **Espacio del usuario (Módulos / Tareas)**

  * Lógica específica del dominio
  * IO y efectos secundarios (vía capacidades)
  * Ejecución cooperativa de tareas

Los módulos NO DEBEN:

* Gestionar concurrencia independientemente
* Interrumpir otras tareas directamente
* Acceder a internos del kernel
* Omitir supervisión

---

## Modelo de Multitarea

El Kernel DEBE soportar ejecución concurrente de:

* Planificación cognitiva
* Procesamiento de lenguaje natural
* Tareas de escucha / detección
* Tareas de habla / incorporación
* Monitoreo o comportamientos en segundo plano

La multitarea es **de primera clase**, no incidental.

El Kernel permanece receptivo incluso mientras las tareas están en ejecución.

---

## Semántica de Interrupción

Las interrupciones son:

* Explícitas
* Orientadas a la intención
* Observables
* Reversibles cuando sea posible

Ejemplos:

* El usuario habla mientras ANIMA está hablando
* Una tarea de mayor prioridad reemplaza a una de menor prioridad
* Se revoca una capacidad en medio de la ejecución
* Un evento ambiental invalida un plan

Las interrupciones se enrutan a través del Kernel, nunca directamente entre tareas.

---

## Restricciones e Invariantes

Las siguientes restricciones son invariantes arquitectónicas:

* El Núcleo NUNCA DEBE bloquear en la ejecución de tareas
* Todo comportamiento de larga duración DEBE estar basado en tareas
* Todas las interrupciones DEBEN pasar por el Kernel
* Las tareas DEBEN ser interrumpibles por diseño
* Las transiciones de estado DEBEN ser observables y registradas
* Ningún módulo puede controlar unilateralmente el flujo de ejecución

Estas restricciones garantizan seguridad, previsibilidad y depurabilidad.

---

## Consecuencias

### Positivas

* Permite interacción natural, similar a la humana
* Soporta capacidad de respuesta en tiempo real
* Hace que la interrupción sea segura y explicable
* Permite composición de comportamiento complejo
* Simplifica el razonamiento sobre el estado del sistema
* Alinea cognición, lenguaje e incorporación bajo un supervisor

---

### Tradeoffs

* Aumenta la complejidad arquitectónica
* Requiere diseño disciplinado de tareas
* Requiere modelado explícito de ciclo de vida
* Hace "hacks rápidos" imposibles por diseño

Estos tradeoffs son intencionales y necesarios para los objetivos de ANIMA.

---

## Justificación

La interacción humana es orientada a interrupciones, concurrente y contextual.

Un sistema que no puede pausar, reconsiderar o repriorizar **no puede comportarse inteligentemente en entornos reales**.

Al adoptar un modelo de kernel:

* ANIMA gana conciencia temporal
* El comportamiento se vuelve componible
* La seguridad se vuelve aplicable
* La inteligencia se vuelve sostenible a lo largo del tiempo

---

## Trabajo Futuro

* Formalizar políticas de prioridad y programación de tareas
* Definir heurísticas de preferencia de tareas
* Implementar contabilidad de recursos a nivel de kernel
* Crear herramientas para introspección y replay de tareas
* Documentar mejores prácticas para diseño cooperativo de tareas

---

### Declaración Final

> **ANIMA no ejecuta instrucciones.
> Supervisa comportamiento.**

Esa es la propiedad definitoria de su Núcleo.
