# ADR-011: Arquitectura de Entrada Basada en Eventos con Eventos de Lenguaje Natural, Sistema y Semánticos

**Estado:** Aceptado  
**Fecha:** 2026-01-07  
**Decisores:** @RichardRosenblat  
**Contexto:** Modularidad, Observabilidad, Interrupciones, PLN Opcional

---

## Contexto

Acoplar directamente el Núcleo a entradas crudas (audio, texto, sensores) causa acoplamiento rígido, lógica de PLN duplicada y comportamiento implícito inseguro. Para preservar modularidad, seguridad y trazabilidad, el Núcleo debe consumir solo eventos estructurados vía un contrato unificado.

---

## Decisión

El Núcleo ANIMA consume solo eventos de entrada estructurados, nunca señales crudas.

Todas las entradas—humanas, de sistema o ambientales—DEBEN ser transformadas en eventos por módulos (vía su Adaptador) antes de alcanzar el Núcleo.

Los tipos de evento son canónicos y con namespace:
- input.nl — lenguaje natural (pre-semántico)
- input.system — hechos no-lingüísticos, mecánicos/del sistema
- input.semantic — significado asertado post-interpretación

---

## Sobre de Evento

Todos los eventos de entrada DEBEN usar el sobre de evento:
- payload DEBE ser estructurado y determinístico
- incluir execution_id, trace_id, span_id, thread_id, timestamp
- cualquier metadato adicional por ADR-004

---

## Categorías de Eventos Canónicos

### 1) Lenguaje Natural (input_nl; Pre-Semántico)
Representa contenido lingüístico crudo después de captura/transcripción, sin interpretación.

Características:
- sin intención
- sin suposiciones
- baja confianza
- provenance="observed"

Ejemplo:
```json
{
  "execution_id": "exec-123",
  "trace_id": "trace-aaa",
  "span_id": "span-001",
  "parent_span_id": null,
  "thread_id": "input-mic-1",
  "timestamp": "2026-01-07T12:34:56Z",
  "source": "module:microphone",
  "type": "input.nl",
  "payload": {
    "text": "send this file to discord",
    "language": "en-US",
    "confidence": 0.93,
    "provenance": "observed"
  }
}
```

---

### 2) Sistema / Mecánico (input.system; No-Lenguaje-Natural)
Representa hechos observables o cambios de estado, no lenguaje.

Características:
- hechos determinísticos
- alta confianza
- ninguna interpretación lingüística requerida

Ejemplo:
```json
{
  "execution_id": "exec-123",
  "trace_id": "trace-bbb",
  "span_id": "span-010",
  "parent_span_id": null,
  "thread_id": "input-vscode",
  "timestamp": "2026-01-07T12:35:10Z",
  "source": "module:vscode",
  "type": "input.system",
  "payload": {
    "action": "file_opened",
    "path": "/project/main.py"
  }
}
```

---

### 3) Semántico (input.semantic; Post-Interpretación)
Representa significado asertado extraído por una capa de PLN de un módulo capaz de PLN o el Arcuate opcional.

Características:
- intención explícita + confianza + procedencia
- Núcleo razona directamente sobre estos
- omite procesamiento lingüístico adicional

Ejemplo:
```json
{
  "execution_id": "exec-123",
  "trace_id": "trace-ccc",
  "span_id": "span-020",
  "parent_span_id": null,
  "thread_id": "nlp-arcuate",
  "timestamp": "2026-01-07T12:35:20Z",
  "source": "adapter:arcuate",
  "type": "input.semantic",
  "payload": {
    "intent": "send_message",
    "target": "discord",
    "content_ref": "file://active",
    "confidence": 0.88,
    "provenance": "arcuate"
  }
}
```

---

## Papel del Arcuate (ADR-009)

- El Arcuate del núcleo es un traductor (PLN), no un controlador
- Responsabilidades:
  - consumir eventos input.nl
  - producir eventos input.semantic
- Restricciones:
  - opcional y intercambiable
  - NO DEBE acceder a memoria del Núcleo directamente
  - NO DEBE realizar planificación
  - payloads semánticos DEBEN incluir confianza y procedencia

Los módulos pueden producir input.semantic directamente si incorporan PLN; el Núcleo permanece agnóstico al origen del significado.

---

## Responsabilidades del Núcleo

El Núcleo DEBE:
- ingerir eventos vía una cola de eventos unificada
- razonar solo sobre eventos, no señales crudas
- tratar input.semantic como significado asertado sujeto a políticas de seguridad
- usar eventos para impulsar planificación, creación de tareas, interrupción y aplicación de política

---

## Interrupciones como Eventos (ADR-005)

Las interrupciones entran como eventos de entrada:

```json
{
  "type": "input.semantic",
  "payload": {
    "intent": "interrupt",
    "target": "speech_output",
    "urgency": "high",
    "confidence": 0.95,
    "provenance": "arcuate|module"
  }
}
```

Esto permite clasificación consistente (override/cancel/queue/clarification/emergency), aplicación de política y trazabilidad.

---

## Observabilidad & Trazabilidad (ADR-004)

Todos los eventos:
- llevan IDs de ejecución y correlación
- se registran como registros estructurados en líneas de tiempo particionadas por ejecución
- soportan reproducibilidad, auditabilidad y visibilidad concurrente

---

## Consecuencias

### Positivas
- Fuerte desacoplamiento entre Núcleo y módulos
- Fronteras de confianza claras
- Manejo natural de interrupciones
- Comportamiento más seguro y auditable
- Preparación para clustering/distribución futura

### Tradeoffs
- Requiere schemas de evento disciplinados
- Necesita herramientas de visualización
- Los módulos deben adherirse a contratos de evento

---

## ADRs Relacionados

- ADR-003 — Protocolo Núcleo ↔ Módulo, leases
- ADR-004 — Modelo de observabilidad
- ADR-005 — Modelo de interrupción
- ADR-007 — Reglas de infraestructura & adaptador
- ADR-009 — Arcuate Opcional (PLN)
- ADR-010 — División Adaptador–Actuador

---

## Declaración Final

ANIMA es un motor de razonamiento de eventos.  
El significado entra al Núcleo ya moldeado como eventos de entrada.  
Adaptadores estandarizan, el kernel supervisa y el Núcleo razona.
